<!DOCTYPE html><html lang="en"><head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
<title>CueAside</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500;600&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
/* ‚ïê‚ïê‚ïê DESIGN SYSTEM ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
/* Design 2 (Minimalist) ‚Äî default, vars already defined below in :root     */
/* Design 1 (Bold) ‚Äî activated via html[data-design="1"]                    */

/* ‚îÄ‚îÄ PLASTER OVERLAY ‚îÄ‚îÄ */
#design-plaster{
  position:fixed;inset:0;z-index:9999;background:var(--bg);
  display:flex;flex-direction:column;align-items:center;justify-content:center;gap:14px;
  opacity:0;pointer-events:none;transition:opacity .2s;
}
#design-plaster.show{opacity:1;pointer-events:all}
#design-plaster .plaster-ring{
  width:32px;height:32px;border-radius:50%;
  border:2px solid var(--bg4);border-top-color:var(--acc);
  animation:spin .7s linear infinite;
}
#design-plaster .plaster-txt{font-size:12px;color:var(--txt3);letter-spacing:.06em}
@keyframes spin{to{transform:rotate(360deg)}}

/* ‚ïê‚ïê DESIGN 1: BOLD (Nunito, cards, rounded, glows) ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
html[data-design="1"]{
  --font-main:'Nunito',sans-serif;
  --font-mono:'JetBrains Mono',monospace;
}
html[data-design="1"] body{font-family:'Nunito',sans-serif}
html[data-design="1"] .topbar{
  padding:16px 20px 12px;border-bottom:none;
  background:linear-gradient(var(--bg2) 80%,transparent);
}
html[data-design="1"] .topbar h1{font-size:22px!important;font-weight:900;letter-spacing:-.5px;display:block!important}
html[data-design="1"] .topbar-label{display:none!important}
html[data-design="2"] .topbar h1{display:none!important}
html[data-design="2"] .topbar-label{display:block!important}
html[data-design="1"] .topbar-btn{border-radius:50%;border:none;background:var(--bg3)}
html[data-design="1"] #nav{height:72px;justify-content:space-around;padding:0 8px}
html[data-design="1"] .nav-item{gap:4px}
html[data-design="1"] .nav-item span{font-size:10px;font-weight:700;letter-spacing:.5px}
html[data-design="1"] .nav-item svg{width:24px;height:24px}
html[data-design="1"] .nav-item.active::after{display:none}
html[data-design="1"] .nav-dot{width:4px;height:4px;border-radius:50%;background:var(--acc);margin:-2px auto 0;opacity:0;transition:opacity var(--trans)}
html[data-design="1"] .nav-item.active .nav-dot{opacity:1}
html[data-design="1"] .fab{
  width:56px;height:56px;border-radius:50%;padding:0;
  font-size:22px;font-weight:900;
  background:linear-gradient(135deg,var(--acc2),var(--acc));
  box-shadow:0 6px 20px color-mix(in srgb,var(--acc) 35%,transparent);
  bottom:88px;
}
html[data-design="1"] .rcard{
  background:var(--bg2);border-radius:16px;border:1px solid var(--bg4);
  margin:0 16px 10px;padding:14px 16px;border-bottom:none;
}
html[data-design="1"] .rcard:last-child{border:1px solid var(--bg4)}
html[data-design="1"] .rcard-icon{width:48px;height:48px;border-radius:14px;border:none;background:var(--bg3)}
html[data-design="1"] .rcard-name{font-size:15px;font-weight:700}
html[data-design="1"] .rcard-sub{font-size:12px}
html[data-design="1"] .chip{border-radius:99px;padding:4px 12px;font-size:12px;font-weight:600}
html[data-design="1"] .row{border-radius:0;padding:14px 20px}
html[data-design="1"] .sheet{border-radius:24px 24px 0 0}
html[data-design="1"] .sheet-header{border-bottom:none}
html[data-design="1"] .sheet-header h2{font-size:18px;font-weight:900}
html[data-design="1"] .sheet-close{border-radius:50%}
html[data-design="1"] .btn{border-radius:12px;font-size:15px;font-weight:700;padding:14px}
html[data-design="1"] .btn-primary{background:linear-gradient(135deg,var(--acc2),var(--acc));color:#fff}
html[data-design="1"] .form-input{border-radius:var(--rad3);font-size:15px;padding:12px 14px}
html[data-design="1"] .toggle-track::after{background:#fff}
html[data-design="1"] .app-item{padding:10px 16px;border-bottom:none}
html[data-design="1"] .app-item.selected{background:rgba(79,195,247,.08)}
html[data-design="1"] .app-icon-box{width:44px;height:44px;border-radius:12px;border:none;font-size:22px}
html[data-design="1"] .app-name{font-size:14px;font-weight:700}
html[data-design="1"] .app-check{width:22px;height:22px;border-radius:50%;border:2px solid var(--bg4)}
html[data-design="1"] .app-item.selected .app-check{background:var(--acc);border-color:var(--acc)}
html[data-design="1"] .search-wrap{border-radius:12px;margin:0 16px 8px;border:1px solid var(--bg4)}
html[data-design="1"] .step-dot{height:3px;border-radius:99px}
html[data-design="1"] .icon-opt{border-radius:8px}
html[data-design="1"] .icon-opt .ico{border-radius:10px;width:40px;height:40px;font-size:22px}
html[data-design="1"] #snack{
  border-radius:99px;font-size:13px;font-weight:600;bottom:88px;
  box-shadow:0 4px 20px rgba(0,0,0,.4);
}
html[data-design="1"] .badge{border-radius:99px}
html[data-design="1"] .theme-swatch{width:48px;height:48px}
html[data-design="1"] #debug-panel{border-top:none}
/* D1 topbar titles */
/* D1 titles via real h1 elements */

/* ‚ïê‚ïê DESIGN 2: MINIMALIST (DM Sans, lines, flat) ‚Äî default active ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
html[data-design="2"] .nav-dot{display:none}
html[data-design="2"] .topbar h1{display:none}

/* ‚îÄ‚îÄ SHARED FONT LOADS ‚îÄ‚îÄ */

:root{
--bg:#0e0e0e;--bg2:#161616;--bg3:#1e1e1e;--bg4:#2a2a2a;--bg5:#333;
--acc:#e8e8e8;--acc2:#aaa;--acc-dim:rgba(232,232,232,.08);
--txt:#e8e8e8;--txt2:#888;--txt3:#444;
--danger:#c0392b;--warn:#b07d2a;--ok:#2d7a4f;
--rad:12px;--rad2:8px;--rad3:4px;
--trans:.15s ease;
--line:1px solid var(--bg4);
}
[data-theme="light"]{
--bg:#f5f5f5;--bg2:#ffffff;--bg3:#efefef;--bg4:#e0e0e0;--bg5:#d0d0d0;
--acc:#111;--acc2:#555;--acc-dim:rgba(0,0,0,.06);
--txt:#111;--txt2:#666;--txt3:#bbb;
--danger:#c0392b;--warn:#b07d2a;--ok:#2d7a4f;
--line:1px solid #e0e0e0;
}
[data-theme="aurora"]{
--bg:#09090f;--bg2:#0f0f1a;--bg3:#16162a;--bg4:#1e1e38;--bg5:#252545;
--acc:#b8a9f0;--acc2:#7b6dc0;--acc-dim:rgba(184,169,240,.08);
--txt:#e8e4ff;--txt2:#7070a0;--txt3:#363660;
}
[data-theme="sunset"]{
--bg:#100808;--bg2:#1a0f0f;--bg3:#241515;--bg4:#2e1b1b;--bg5:#382222;
--acc:#e8a87c;--acc2:#a06040;--acc-dim:rgba(232,168,124,.08);
--txt:#ffe8d8;--txt2:#806050;--txt3:#503830;
}
[data-theme="ocean"]{
--bg:#060d10;--bg2:#0c1820;--bg3:#102030;--bg4:#162a40;--bg5:#1c3450;
--acc:#7ac8d8;--acc2:#3a8090;--acc-dim:rgba(122,200,216,.08);
--txt:#d8f0f8;--txt2:#406878;--txt3:#204050;
}
[data-theme="forest"]{
--bg:#070d07;--bg2:#0d160d;--bg3:#121e12;--bg4:#182618;--bg5:#1e2e1e;
--acc:#7ac87a;--acc2:#3a783a;--acc-dim:rgba(122,200,122,.08);
--txt:#d8f0d8;--txt2:#406840;--txt3:#204020;
}
[data-theme="candy"]{
--bg:#0d080f;--bg2:#160f1a;--bg3:#1e1526;--bg4:#261b30;--bg5:#2e223a;
--acc:#d8a0d8;--acc2:#886088;--acc-dim:rgba(216,160,216,.08);
--txt:#f0d8f8;--txt2:#786088;--txt3:#403050;
}
[data-theme="lava"]{
--bg:#100600;--bg2:#1a0e00;--bg3:#241400;--bg4:#2e1c00;--bg5:#382400;
--acc:#e09060;--acc2:#905030;--acc-dim:rgba(224,144,96,.08);
--txt:#ffe8d0;--txt2:#806040;--txt3:#503820;
}

*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
html,body{height:100%;background:var(--bg);color:var(--txt);font-family:'DM Sans',sans-serif;overflow:hidden;font-size:14px}
body{display:flex;flex-direction:column;max-width:430px;margin:0 auto}

/* SCREENS */
#app{flex:1;overflow:hidden;position:relative}
.screen{position:absolute;inset:0;overflow-y:auto;overflow-x:hidden;padding:0 0 72px;opacity:0;pointer-events:none;transform:translateY(6px);transition:opacity var(--trans),transform var(--trans)}
.screen.active{opacity:1;pointer-events:all;transform:none}

/* TOPBAR */
.topbar{position:sticky;top:0;z-index:10;padding:20px 20px 14px;background:var(--bg);border-bottom:var(--line);display:flex;align-items:center;gap:10px}
.topbar h1{font-size:15px;font-weight:500;letter-spacing:.02em;flex:1;color:var(--txt)}
.topbar-label{font-size:12px;color:var(--txt3);font-weight:400;letter-spacing:.05em;text-transform:uppercase}
.topbar-btn{width:34px;height:34px;border-radius:var(--rad2);border:var(--line);background:none;color:var(--txt2);display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:14px;transition:background var(--trans)}
.topbar-btn:active{background:var(--bg3)}

/* BOTTOM NAV */
#nav{height:56px;background:var(--bg);border-top:var(--line);display:flex;align-items:stretch;flex-shrink:0}
.nav-item{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:3px;cursor:pointer;border:none;background:none;color:var(--txt3);transition:color var(--trans);position:relative;font-family:'DM Sans',sans-serif}
.nav-item.active{color:var(--txt)}
.nav-item svg{width:18px;height:18px}
.nav-item span{font-size:10px;font-weight:500;letter-spacing:.04em}
.nav-item.active::after{content:'';position:absolute;top:0;left:50%;transform:translateX(-50%);width:24px;height:1px;background:var(--acc)}

/* ROW / ITEM patterns */
.row{display:flex;align-items:center;padding:14px 20px;gap:12px;border-bottom:var(--line);transition:background var(--trans);cursor:pointer}
.row:active{background:var(--acc-dim)}
.row:last-child{border-bottom:none}
.row-label{font-size:14px;font-weight:400;flex:1;color:var(--txt)}
.row-sub{font-size:11px;color:var(--txt3);margin-top:1px}
.row-right{color:var(--txt3);font-size:12px;display:flex;align-items:center;gap:6px;flex-shrink:0}

/* SECTION */
.sec{margin:20px 20px 0;background:var(--bg2);border-radius:var(--rad);border:var(--line);overflow:hidden}
.sec-last{margin-bottom:20px}
.sec-title{font-size:10px;font-weight:500;letter-spacing:.1em;text-transform:uppercase;color:var(--txt3);padding:16px 20px 8px;margin:20px 0 0}

/* BADGE */
.badge{font-size:10px;padding:2px 7px;border-radius:3px;font-weight:500;letter-spacing:.03em}
.badge-req{background:rgba(192,57,43,.15);color:#e05a4a}
.badge-opt{background:rgba(176,125,42,.12);color:#b07d2a}
.badge-ok{background:rgba(45,122,79,.15);color:#2d7a4f}

/* CHIP */
.chip{display:inline-flex;align-items:center;gap:5px;padding:3px 10px;border-radius:3px;background:var(--bg3);border:var(--line);font-size:11px;color:var(--txt2);font-weight:500}
.chip.on{background:var(--acc-dim);border-color:color-mix(in srgb,var(--acc) 30%,transparent);color:var(--acc)}

/* TOGGLE */
.toggle{position:relative;width:40px;height:22px;flex-shrink:0}
.toggle input{opacity:0;width:0;height:0;position:absolute}
.toggle-track{position:absolute;inset:0;background:var(--bg4);border-radius:99px;cursor:pointer;transition:background var(--trans)}
.toggle input:checked+.toggle-track{background:var(--acc)}
.toggle-track::after{content:'';position:absolute;width:16px;height:16px;border-radius:50%;background:var(--bg2);top:3px;left:3px;transition:transform var(--trans)}
[data-theme="light"] .toggle-track::after{background:#fff}
.toggle input:checked+.toggle-track::after{transform:translateX(18px)}

/* DIVIDER */
.divider{height:1px;background:var(--bg4);margin:0}

/* FAB */
.fab{position:fixed;bottom:68px;right:20px;height:44px;padding:0 20px;border-radius:var(--rad2);background:var(--acc);border:none;color:var(--bg);font-size:13px;font-weight:600;display:flex;align-items:center;gap:6px;cursor:pointer;transition:transform var(--trans),opacity var(--trans);z-index:50;font-family:'DM Sans',sans-serif;letter-spacing:.02em}
.fab:active{transform:scale(.96)}
.fab.hidden{opacity:0;pointer-events:none;transform:translateY(8px)}

/* SHEET */
.sheet-overlay{position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:100;opacity:0;pointer-events:none;transition:opacity .2s}
.sheet-overlay.open{opacity:1;pointer-events:all}
.sheet{position:fixed;bottom:0;left:50%;transform:translateX(-50%) translateY(100%);width:100%;max-width:430px;background:var(--bg2);border-top:var(--line);z-index:101;transition:transform .28s cubic-bezier(.4,0,.2,1);max-height:90vh;display:flex;flex-direction:column}
.sheet-overlay.open .sheet{transform:translateX(-50%) translateY(0)}
.sheet-handle{width:28px;height:2px;border-radius:1px;background:var(--bg5);margin:12px auto 0;flex-shrink:0}
.sheet-header{padding:14px 20px 12px;display:flex;align-items:center;gap:10px;flex-shrink:0;border-bottom:var(--line)}
.sheet-header h2{flex:1;font-size:14px;font-weight:500;color:var(--txt)}
.sheet-close{width:28px;height:28px;border-radius:var(--rad3);border:var(--line);background:none;color:var(--txt2);cursor:pointer;font-size:14px;display:flex;align-items:center;justify-content:center}
.sheet-body{overflow-y:auto;flex:1}

/* FORMS */
.form-wrap{padding:16px 20px}
.form-label{font-size:10px;font-weight:500;letter-spacing:.08em;text-transform:uppercase;color:var(--txt3);margin-bottom:6px;display:flex;align-items:center}
.form-input{width:100%;background:var(--bg3);border:var(--line);border-radius:var(--rad3);color:var(--txt);font-family:'DM Sans',sans-serif;font-size:14px;padding:10px 12px;outline:none;transition:border-color var(--trans)}
.form-input:focus{border-color:var(--acc2)}
textarea.form-input{resize:none;line-height:1.55}
select.form-input{-webkit-appearance:none;appearance:none}

/* BTNS */
.btn{width:100%;padding:12px;border-radius:var(--rad2);border:none;font-family:'DM Sans',sans-serif;font-size:13px;font-weight:500;cursor:pointer;transition:opacity var(--trans),transform var(--trans);letter-spacing:.02em}
.btn:active{opacity:.7;transform:scale(.98)}
.btn-primary{background:var(--acc);color:var(--bg)}
.btn-danger{background:none;color:var(--danger);border:1px solid rgba(192,57,43,.25)}
.btn-ghost{background:none;color:var(--txt2);border:var(--line)}

/* APP LIST */
.app-item{display:flex;align-items:center;gap:12px;padding:11px 20px;border-bottom:var(--line);cursor:pointer;transition:background var(--trans)}
.app-item:last-child{border-bottom:none}
.app-item:active,.app-item.selected{background:var(--acc-dim)}
.app-icon-box{width:36px;height:36px;border-radius:var(--rad2);background:var(--bg3);display:flex;align-items:center;justify-content:center;font-size:18px;flex-shrink:0;border:var(--line)}
.app-name{font-size:13px;font-weight:500;flex:1}
.app-pkg{font-size:10px;color:var(--txt3);margin-top:1px;font-family:'DM Mono',monospace}
.app-check{width:18px;height:18px;border-radius:3px;border:var(--line);display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:all var(--trans);background:none}
.app-item.selected .app-check{background:var(--acc);border-color:var(--acc)}
.app-chk-svg{width:10px;height:10px;opacity:0;transition:opacity var(--trans)}
.app-item.selected .app-chk-svg{opacity:1}

/* SEARCH */
.search-wrap{padding:12px 20px;border-bottom:var(--line);display:flex;align-items:center;gap:8px;background:var(--bg)}
.search-wrap input{flex:1;background:none;border:none;outline:none;color:var(--txt);font-family:'DM Sans',sans-serif;font-size:13px}
.search-wrap svg{width:14px;height:14px;color:var(--txt3);flex-shrink:0}

/* STEP BAR */
.step-bar{display:flex;gap:4px;padding:14px 20px 0}
.step-dot{height:2px;border-radius:1px;background:var(--bg4);flex:1;transition:background .3s}
.step-dot.done{background:var(--acc)}

/* ICON GRID */
.icon-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:6px}
.icon-opt{display:flex;flex-direction:column;align-items:center;gap:3px;padding:8px 4px;border-radius:var(--rad3);cursor:pointer;transition:background var(--trans);border:1px solid transparent}
.icon-opt:active{background:var(--bg3)}
.icon-opt.sel{border-color:color-mix(in srgb,var(--acc) 40%,transparent);background:var(--acc-dim)}
.icon-opt .ico{width:36px;height:36px;border-radius:var(--rad3);display:flex;align-items:center;justify-content:center;font-size:18px;background:var(--bg3)}
.icon-opt span{font-size:9px;color:var(--txt3);text-align:center;line-height:1.2}

/* ROUTINE CARD */
.rcard{display:flex;align-items:center;gap:12px;padding:14px 20px;border-bottom:var(--line);cursor:pointer;transition:background var(--trans)}
.rcard:last-child{border-bottom:none}
.rcard:active{background:var(--acc-dim)}
.rcard-icon{width:36px;height:36px;border-radius:var(--rad2);background:var(--bg3);display:flex;align-items:center;justify-content:center;font-size:18px;flex-shrink:0;border:var(--line);overflow:hidden}
.rcard-name{font-size:13px;font-weight:500;color:var(--txt)}
.rcard-sub{font-size:11px;color:var(--txt3);margin-top:2px}
.rcard-meta{display:flex;align-items:center;gap:6px;margin-top:5px;flex-wrap:wrap}

/* THEME SWATCH */
.theme-swatch{width:40px;height:40px;border-radius:50%;cursor:pointer;transition:transform var(--trans);border:2px solid transparent;position:relative;overflow:hidden}
.theme-swatch.active{border-color:var(--acc);transform:scale(1.1)}

/* EMPTY */
.empty{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:10px;padding:60px 24px;color:var(--txt3);text-align:center}
.empty svg{width:40px;height:40px;opacity:.2}
.empty p{font-size:13px;line-height:1.65}

/* SCROLLBAR */
::-webkit-scrollbar{width:2px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:var(--bg5);border-radius:99px}

/* SNACK */
#snack{position:fixed;bottom:68px;left:50%;transform:translateX(-50%) translateY(120%);background:var(--bg2);border:var(--line);color:var(--txt);padding:9px 18px;border-radius:var(--rad2);font-size:12px;font-weight:500;z-index:200;transition:transform .25s;white-space:nowrap;pointer-events:none;letter-spacing:.02em}
#snack.show{transform:translateX(-50%) translateY(0)}

/* DEBUG */
#debug-panel{position:fixed;inset:0;background:var(--bg);z-index:300;display:none;flex-direction:column;border-top:var(--line)}
#debug-panel.open{display:flex}
#debug-log{flex:1;overflow-y:auto;padding:12px;font-family:'DM Mono',monospace;font-size:11px;line-height:1.7;color:var(--txt2)}
.dlog-err{color:var(--danger)}.dlog-warn{color:var(--warn)}.dlog-info{color:var(--acc)}.dlog-log{color:var(--txt3)}

/* CHECK UTILITY */
.chk-row{display:flex;align-items:center;gap:10px;padding:13px 20px;border-bottom:var(--line);cursor:pointer}
.chk-row:last-child{border-bottom:none}
.chk-row input[type=checkbox]{width:16px;height:16px;accent-color:var(--acc);cursor:pointer;flex-shrink:0}
.chk-row input[type=radio]{width:16px;height:16px;accent-color:var(--acc);cursor:pointer;flex-shrink:0}
</style></head>
<body>
<div id="app">
<div class="screen active" id="scr-create">
  <div class="topbar">
    <h1 style="display:none"><span style="color:var(--acc)">+</span> Create</h1>
    <span class="topbar-label">New Routine</span>
    <button class="topbar-btn" onclick="openDebug()" title="Debug">¬∑</button>
  </div>
  <div id="create-content"></div>
</div>
<div class="screen" id="scr-list">
  <div class="topbar">
    <h1 style="display:none">My <span style="color:var(--acc)">Routines</span></h1>
    <span class="topbar-label">Routines</span>
  </div>
  <div id="list-content"></div>
</div>
<div class="screen" id="scr-settings">
  <div class="topbar">
    <h1 style="display:none"><span style="color:var(--acc)">CueAside</span></h1>
    <span class="topbar-label">CueAside</span>
  </div>
  <div id="settings-content"></div>
</div>
</div>

<nav id="nav">
  <button class="nav-item active" data-tab="create" onclick="switchTab('create')">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="3" y="3" width="18" height="18" rx="2"/><line x1="12" y1="8" x2="12" y2="16"/><line x1="8" y1="12" x2="16" y2="12"/></svg>
    <span>Create</span>
  </button>
  <button class="nav-item" data-tab="list" onclick="switchTab('list')">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><line x1="9" y1="6" x2="20" y2="6"/><line x1="9" y1="12" x2="20" y2="12"/><line x1="9" y1="18" x2="20" y2="18"/><line x1="4" y1="6" x2="4" y2="6"/><line x1="4" y1="12" x2="4" y2="12"/><line x1="4" y1="18" x2="4" y2="18"/></svg>
    <span>List</span>
  </button>
  <button class="nav-item" data-tab="settings" onclick="switchTab('settings')">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
    <span>Settings</span>
  </button>
</nav>

<button class="fab hidden" id="fab" onclick="onFab()">Next ‚Üí</button>

<div class="sheet-overlay" id="sheet-overlay" onclick="closeSheetOutside(event)">
  <div class="sheet" id="sheet">
    <div class="sheet-handle"></div>
    <div class="sheet-header">
      <h2 id="sheet-title"></h2>
      <button class="sheet-close" onclick="closeSheet()">‚úï</button>
    </div>
    <div class="sheet-body" id="sheet-body"></div>
  </div>
</div>

<div id="snack"></div>

<div id="design-plaster">
  <div class="plaster-ring"></div>
  <div class="plaster-txt">Applying design‚Ä¶</div>
</div>

<div id="debug-panel">
  <div style="display:flex;align-items:center;padding:12px 16px;border-bottom:var(--line);flex-shrink:0;gap:8px">
    <span style="font-family:'DM Mono',monospace;font-size:12px;font-weight:500;color:var(--txt2);flex:1">debug console</span>
    <button onclick="clearDebug()" style="background:none;border:var(--line);color:var(--txt3);padding:4px 10px;border-radius:var(--rad3);font-size:11px;cursor:pointer;font-family:'DM Sans',sans-serif">clear</button>
    <button onclick="closeDebug()" style="background:var(--bg3);border:var(--line);color:var(--txt2);width:26px;height:26px;border-radius:var(--rad3);cursor:pointer;font-size:12px;display:flex;align-items:center;justify-content:center">‚úï</button>
  </div>
  <div id="debug-log"></div>
</div>

<script>
const V='1.5.0',LS='notify_routines_v1',MAX_MSG=100;
const BUILD_DATE='2026-02-21';
let ST={routines:[],iconLib:[],settings:{defaultBubble:false,theme:'default',design:'2'}};
let CR={step:0,selected:[],multi:false,cond:'launched',dur:20,unit:'m',timeMode:'session',icon:null,titleOn:false,title:'',msg:'',bubble:false};

const APPS=[
  {name:'Camera',pkg:'com.android.camera',icon:'üì∑'},
  {name:'Messages',pkg:'com.android.messages',icon:'üí¨'},
  {name:'YouTube',pkg:'com.google.android.youtube',icon:'‚ñ∂Ô∏è'},
  {name:'Maps',pkg:'com.google.android.maps',icon:'üó∫Ô∏è'},
  {name:'Chrome',pkg:'com.android.chrome',icon:'üåê'},
  {name:'Instagram',pkg:'com.instagram.android',icon:'üì∏'},
  {name:'Spotify',pkg:'com.spotify.music',icon:'üéµ'},
  {name:'Gmail',pkg:'com.google.android.gmail',icon:'üìß'},
  {name:'Phone',pkg:'com.android.dialer',icon:'üìû'},
  {name:'Settings',pkg:'com.android.settings',icon:'‚öôÔ∏è'},
  {name:'Gallery',pkg:'com.android.gallery',icon:'üñºÔ∏è'},
  {name:'Calendar',pkg:'com.android.calendar',icon:'üìÖ'},
  {name:'Clock',pkg:'com.android.clock',icon:'‚è∞'},
  {name:'Files',pkg:'com.android.files',icon:'üìÅ'},
  {name:'Calculator',pkg:'com.android.calculator',icon:'üî¢'},
  {name:'Contacts',pkg:'com.android.contacts',icon:'üë§'},
  {name:'Play Store',pkg:'com.android.vending',icon:'üè™'},
  {name:'Notes',pkg:'com.android.notes',icon:'üìù'},
];

const PRESETS=[
  {e:'üîî',l:'Bell'},{e:'üöÄ',l:'Launch'},{e:'‚ö°',l:'Flash'},{e:'üéØ',l:'Target'},
  {e:'üî•',l:'Fire'},{e:'üí°',l:'Idea'},{e:'üéÆ',l:'Game'},{e:'üèÉ',l:'Run'},
  {e:'üì±',l:'Phone'},{e:'üåô',l:'Night'},{e:'‚òÄÔ∏è',l:'Day'},{e:'üîï',l:'Silent'},
  {e:'üíº',l:'Work'},{e:'üè†',l:'Home'},{e:'üéµ',l:'Music'},{e:'üìç',l:'Place'},
  {e:'‚è±Ô∏è',l:'Timer'},{e:'üîê',l:'Lock'},{e:'üëÅÔ∏è',l:'Watch'},{e:'‚ú®',l:'Shine'},
];

// ‚îÄ‚îÄ THEME ‚îÄ‚îÄ
const THEMES=[
  {id:'default',label:'Dark',bg:'#111318',a:'#4fc3f7',b:'#7c4dff'},
  {id:'light',label:'Light',bg:'#ffffff',a:'#1976d2',b:'#6200ea'},
  {id:'aurora',label:'Aurora',bg:'#0f1117',a:'#a78bfa',b:'#34d399'},
  {id:'sunset',label:'Sunset',bg:'#150c10',a:'#fb923c',b:'#e11d48'},
  {id:'ocean',label:'Ocean',bg:'#0a1620',a:'#22d3ee',b:'#0ea5e9'},
  {id:'forest',label:'Forest',bg:'#0c150c',a:'#4ade80',b:'#16a34a'},
  {id:'candy',label:'Candy',bg:'#160c18',a:'#f9a8d4',b:'#c084fc'},
  {id:'lava',label:'Lava',bg:'#1a0800',a:'#ff6b35',b:'#ff3d00'},
];
function applyTheme(id){
  document.documentElement.setAttribute('data-theme',id==='default'?'':id);
  ST.settings.theme=id;
}
function setTheme(id){applyTheme(id);save();renderSettings();dlog('Theme: '+id)}

// ‚îÄ‚îÄ DESIGN SWITCHER ‚îÄ‚îÄ
const DESIGNS=[
  {id:'1',label:'Bold',desc:'Rounded cards, vibrant accents'},
  {id:'2',label:'Minimal',desc:'Flat lines, restrained type'},
];
function applyDesign(id){
  document.documentElement.setAttribute('data-design',id);
  ST.settings.design=id;
  // load Nunito for D1 if not already loaded
  if(id==='1'&&!document.getElementById('font-nunito')){
    const l=document.createElement('link');
    l.id='font-nunito';l.rel='stylesheet';
    l.href='https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;900&family=JetBrains+Mono:wght@400;700&display=swap';
    document.head.appendChild(l);
    dlog('Loaded Nunito font');
  }
}
function switchDesign(id){
  if(id===ST.settings.design)return;
  const p=document.getElementById('design-plaster');
  p.classList.add('show');
  dlog('Design switching to: '+id);
  // brief plaster hold ‚Äî enough for CSS repaint
  setTimeout(()=>{
    applyDesign(id);
    save();
    renderSettings();
    setTimeout(()=>p.classList.remove('show'),220);
    dlog('Design applied: '+id);
  },320);
}



function save(){try{localStorage.setItem(LS,JSON.stringify(ST));dlog('Saved')}catch(e){dwarn('Save: '+e)}}
function load(){try{const d=localStorage.getItem(LS);if(d){const p=JSON.parse(d);if(p.routines)ST.routines=p.routines;if(p.iconLib)ST.iconLib=p.iconLib;if(p.settings)ST.settings=Object.assign(ST.settings,p.settings);dlog('Loaded: '+ST.routines.length+' routines')}}catch(e){dwarn('Load: '+e)}}

// ‚îÄ‚îÄ DEBUG ‚îÄ‚îÄ
function dlog(m){_dl('log',m)}function dwarn(m){_dl('warn',m)}function derr(m){_dl('err',m)}
function _dl(t,m){
  const ts=new Date().toTimeString().slice(0,8);
  const el=document.getElementById('debug-log');
  const d=document.createElement('div');d.className='dlog-'+t;
  d.textContent=`[${ts}][${t.toUpperCase()}] ${m}`;
  el.appendChild(d);el.scrollTop=el.scrollHeight;
  console[t==='err'?'error':t==='warn'?'warn':'log']('[NR] '+m);
}
function openDebug(){document.getElementById('debug-panel').classList.add('open');dlog('Debug opened')}
function closeDebug(){document.getElementById('debug-panel').classList.remove('open')}
function clearDebug(){document.getElementById('debug-log').innerHTML='';dlog('Cleared')}

// ‚îÄ‚îÄ SNACK ‚îÄ‚îÄ
let _st;
function snack(m){const el=document.getElementById('snack');el.textContent=m;el.classList.add('show');clearTimeout(_st);_st=setTimeout(()=>el.classList.remove('show'),2400)}

// ‚îÄ‚îÄ NAV ‚îÄ‚îÄ
let curTab='create';
function switchTab(t){
  if(t===curTab)return;
  document.querySelector('.nav-item.active')?.classList.remove('active');
  document.querySelector(`[data-tab="${t}"]`).classList.add('active');
  document.getElementById('scr-'+curTab).classList.remove('active');
  document.getElementById('scr-'+t).classList.add('active');
  curTab=t;
  if(t==='list')renderList();
  if(t==='settings')renderSettings();
  hideFab();dlog('Tab: '+t);
}

// ‚îÄ‚îÄ FAB ‚îÄ‚îÄ
function showFab(l){const f=document.getElementById('fab');f.textContent=l||'‚Üí';f.classList.remove('hidden')}
function hideFab(){document.getElementById('fab').classList.add('hidden')}
function onFab(){if(curTab==='create'){if(CR.step===0)proceedFn();else saveRoutine();}}

// ‚îÄ‚îÄ SHEET ‚îÄ‚îÄ
function openSheet(title,html){
  document.getElementById('sheet-title').textContent=title;
  document.getElementById('sheet-body').innerHTML=html;
  document.getElementById('sheet-overlay').classList.add('open');
}
function closeSheet(){document.getElementById('sheet-overlay').classList.remove('open')}
function closeSheetOutside(e){if(e.target===document.getElementById('sheet-overlay'))closeSheet()}

// ‚îÄ‚îÄ CREATE ‚îÄ‚îÄ
function renderCreate(){
  document.getElementById('create-content').innerHTML=CR.step===0?renderAppSel():renderFnCfg();
}

function renderAppSel(){
  const c=CR.selected.length;
  return `<div class="step-bar"><div class="step-dot done"></div><div class="step-dot"></div></div>
  <div style="padding:12px 20px;border-bottom:var(--line);display:flex;gap:8px;align-items:center">
    <span class="chip${!CR.multi?' on':''}" onclick="setMode(false)" style="cursor:pointer;flex:1;justify-content:center">Single</span>
    <span class="chip${CR.multi?' on':''}" onclick="setMode(true)" style="cursor:pointer;flex:1;justify-content:center">Multi</span>
    <span style="font-size:11px;color:var(--txt3);flex-shrink:0">${c} selected</span>
  </div>
  <div class="search-wrap">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
    <input id="app-search" placeholder="Search apps" oninput="filterApps(this.value)" autocomplete="off">
  </div>
  <div id="app-list">${APPS.map(a=>appRow(a)).join('')}</div>`;
}

function appRow(a){
  const sel=CR.selected.some(s=>s.pkg===a.pkg);
  return `<div class="app-item${sel?' selected':''}" onclick="toggleApp('${a.pkg}')" data-pkg="${a.pkg}">
    <div class="app-icon-box">${a.icon}</div>
    <div class="app-info"><div class="app-name">${a.name}</div><div class="app-pkg">${a.pkg}</div></div>
    <div class="app-check"><svg class="app-chk-svg" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3"><polyline points="20 6 9 17 4 12"/></svg></div>
  </div>`;
}

function setMode(m){
  CR.multi=m;
  if(!m&&CR.selected.length>1)CR.selected=[CR.selected[0]];
  renderCreate();updateFab();
}

function toggleApp(pkg){
  const app=APPS.find(a=>a.pkg===pkg);
  const idx=CR.selected.findIndex(s=>s.pkg===pkg);
  if(idx>=0){CR.selected.splice(idx,1)}
  else{
    if(!CR.multi)CR.selected=[];
    CR.selected.push(app);
    if(!CR.multi){proceedFn();return;}
  }
  renderCreate();updateFab();
  dlog('Sel: '+CR.selected.map(s=>s.name).join(', '));
}

function filterApps(q){
  const ql=q.toLowerCase();
  document.querySelectorAll('#app-list .app-item').forEach(r=>{
    const match=r.querySelector('.app-name').textContent.toLowerCase().includes(ql)||
                r.querySelector('.app-pkg').textContent.toLowerCase().includes(ql);
    r.style.display=match?'':'none';
  });
}

function updateFab(){
  if(CR.step===0&&CR.selected.length>0&&CR.multi)showFab('Next ‚Üí');
  else if(CR.step===1)showFab('Save');
  else hideFab();
}

function proceedFn(){
  if(!CR.selected.length){snack('Select at least one app');return;}
  CR.step=1;renderCreate();showFab('Save');
  dlog('Step 2: '+CR.selected.map(s=>s.name).join(', '));
}

function renderFnCfg(){
  const apps=CR.selected;
  const appIcons=apps.map(a=>`
    <div class="icon-opt${CR.icon?.type==='app'&&CR.icon?.pkg===a.pkg?' sel':''}" onclick="pickIcon('app','${a.pkg}')">
      <div class="ico">${a.icon}</div><span>${a.name}</span>
    </div>`).join('');
  const libIcons=ST.iconLib.map((src,i)=>`
    <div class="icon-opt${CR.icon?.type==='lib'&&CR.icon?.idx===i?' sel':''}" onclick="pickIcon('lib',${i})">
      <div class="ico"><img src="${src}" style="width:32px;height:32px;border-radius:6px;object-fit:cover"></div>
      <span>Saved ${i+1}</span>
    </div>`).join('');

  return `<div class="step-bar"><div class="step-dot done"></div><div class="step-dot done"></div></div>
  <div style="padding:10px 20px;border-bottom:var(--line)">
    <button onclick="backToSel()" style="background:none;border:none;color:var(--txt3);font-size:12px;cursor:pointer;font-family:'DM Sans',sans-serif;padding:0;letter-spacing:.02em">‚Üê Back</button>
  </div>

  <div style="padding:12px 20px;border-bottom:var(--line);display:flex;flex-wrap:wrap;gap:6px">
    ${apps.map(a=>`<span class="chip on">${a.icon} ${a.name}</span>`).join('')}
  </div>

  <div style="padding:10px 20px 4px;font-size:10px;font-weight:500;letter-spacing:.1em;text-transform:uppercase;color:var(--txt3)">Condition</div>
  <label class="chk-row">
    <input type="radio" name="cond" value="launched" ${CR.cond==='launched'?'checked':''} onchange="setCond('launched')">
    <span class="row-label">When Launched</span>
  </label>
  <label class="chk-row">
    <input type="radio" name="cond" value="used" ${CR.cond==='used'?'checked':''} onchange="setCond('used')">
    <span class="row-label">Time-based</span>
  </label>
  <div id="used-sub" style="display:${CR.cond==='used'?'block':'none'}">
    <div style="padding:0 20px 10px;display:flex;gap:6px">
      <div onclick="CR.timeMode='session';renderCreate();showFab('Save')" style="flex:1;padding:10px 8px;border-radius:var(--rad2);border:1px solid ${CR.timeMode==='session'?'var(--acc)':'var(--bg4)'};background:${CR.timeMode==='session'?'var(--acc-dim)':'var(--bg3)'};cursor:pointer;text-align:center">
        <div style="font-size:12px;font-weight:600;color:${CR.timeMode==='session'?'var(--acc)':'var(--txt)'};margin-bottom:3px">Session</div>
        <div style="font-size:10px;color:var(--txt3);line-height:1.4">Continuous time<br>in this open</div>
      </div>
      <div onclick="CR.timeMode='total';renderCreate();showFab('Save')" style="flex:1;padding:10px 8px;border-radius:var(--rad2);border:1px solid ${CR.timeMode==='total'?'var(--acc)':'var(--bg4)'};background:${CR.timeMode==='total'?'var(--acc-dim)':'var(--bg3)'};cursor:pointer;text-align:center">
        <div style="font-size:12px;font-weight:600;color:${CR.timeMode==='total'?'var(--acc)':'var(--txt)'};margin-bottom:3px">Total (24h)</div>
        <div style="font-size:10px;color:var(--txt3);line-height:1.4">Cumulative use<br>across the day</div>
      </div>
    </div>
    <div style="padding:0 20px 12px;display:flex;align-items:center;gap:8px">
      <span style="font-size:12px;color:var(--txt2);flex-shrink:0">Trigger after</span>
      <input id="dur-v" type="number" min="1" value="${CR.dur||20}" class="form-input" style="width:68px;padding:8px 10px;font-size:13px;flex:none" oninput="CR.dur=+this.value">
      <select id="dur-u" class="form-input" style="width:76px;padding:8px 10px;font-size:13px;flex:none" onchange="CR.unit=this.value">
        <option value="m" ${CR.unit==='m'?'selected':''}>min</option>
        <option value="h" ${CR.unit==='h'?'selected':''}>hr</option>
        <option value="s" ${CR.unit==='s'?'selected':''}>sec</option>
      </select>
      <span style="font-size:11px;color:var(--txt3)">of ${CR.timeMode==='session'?'session':'total daily'} use</span>
    </div>
    <div style="margin:0 20px 12px;padding:10px 12px;background:var(--bg3);border-radius:var(--rad2);border:var(--line)">
      <div style="font-size:10px;color:var(--txt3);font-weight:500;letter-spacing:.06em;margin-bottom:4px">${CR.timeMode==='session'?'SESSION MODE':'TOTAL MODE'}</div>
      <div style="font-size:11px;color:var(--txt2);line-height:1.55">
        ${CR.timeMode==='session'
          ? 'Fires when you stay inside the app uninterrupted for the set time. Resets when you leave and come back.'
          : 'Fires once the app accumulates the set time across all opens today. Resets at midnight.'}
      </div>
      <!-- TODO(java): session ‚Üí AccessibilityService foreground timer | total ‚Üí UsageStatsManager.queryUsageStats(INTERVAL_DAILY) -->
    </div>
  </div>
  <label class="chk-row">
    <input type="radio" name="cond" value="exiting" ${CR.cond==='exiting'?'checked':''} onchange="setCond('exiting')">
    <span class="row-label">When Exiting</span>
    <!-- TODO(java): AccessibilityService TYPE_WINDOW_STATE_CHANGED -->
  </label>

  <div style="height:1px;background:var(--bg4);margin-top:4px"></div>
  <div style="padding:10px 20px 4px;font-size:10px;font-weight:500;letter-spacing:.1em;text-transform:uppercase;color:var(--txt3)">Notification Icon</div>
  <div style="padding:8px 20px">
    <div style="font-size:10px;color:var(--txt3);margin-bottom:8px;letter-spacing:.06em">FROM APP</div>
    <div class="icon-grid">${appIcons}</div>
    <div style="font-size:10px;color:var(--txt3);margin:12px 0 8px;letter-spacing:.06em">PRESETS</div>
    <div class="icon-grid">
      ${PRESETS.map(ic=>`<div class="icon-opt${CR.icon?.type==='preset'&&CR.icon?.e===ic.e?' sel':''}" onclick="pickIcon('preset','${ic.e}')">
        <div class="ico">${ic.e}</div><span>${ic.l}</span>
      </div>`).join('')}
    </div>
    ${ST.iconLib.length?`<div style="font-size:10px;color:var(--txt3);margin:12px 0 8px;letter-spacing:.06em">LIBRARY</div><div class="icon-grid">${libIcons}</div>`:''}
    <label style="display:flex;align-items:center;gap:10px;cursor:pointer;padding:11px 12px;background:var(--bg3);border-radius:var(--rad2);border:var(--line);margin-top:10px">
      <span style="font-size:18px">‚Üë</span>
      <div style="flex:1"><div style="font-size:12px;font-weight:500">Upload photo as icon</div><div style="font-size:11px;color:var(--txt3);margin-top:1px">Saved to icon library</div></div>
      <input type="file" accept="image/*" style="display:none" onchange="uploadIcon(this)">
    </label>
  </div>

  <div style="height:1px;background:var(--bg4)"></div>
  <label class="chk-row">
    <input type="checkbox" id="chk-t" ${CR.titleOn?'checked':''} onchange="CR.titleOn=this.checked;tgl('title-f',this.checked)">
    <span class="row-label">Title <span style="color:var(--txt3);font-weight:300">(optional)</span></span>
  </label>
  <div id="title-f" style="${CR.titleOn?'':'display:none'};padding:0 20px 12px">
    <input class="form-input" id="notif-t" placeholder="Notification title" maxlength="50" value="${CR.title}" oninput="CR.title=this.value">
  </div>

  <div style="padding:4px 20px 12px">
    <div style="font-size:10px;font-weight:500;letter-spacing:.08em;text-transform:uppercase;color:var(--txt3);margin-bottom:6px;display:flex;align-items:center">Message <span id="mc" style="margin-left:auto;font-weight:400">${CR.msg.length}/${MAX_MSG}</span></div>
    <textarea class="form-input" id="notif-m" rows="3" placeholder="Notification message" maxlength="${MAX_MSG}" oninput="CR.msg=this.value;document.getElementById('mc').textContent=this.value.length+'/${MAX_MSG}'">${CR.msg}</textarea>
    <!-- TODO(java): NotificationCompat.Builder.setContentText(msg).setContentTitle(title) -->
  </div>

  <label class="chk-row" style="margin-bottom:4px">
    <input type="checkbox" ${CR.bubble?'checked':''} onchange="CR.bubble=this.checked">
    <div style="flex:1">
      <div class="row-label">Bubble notification</div>
      <div style="font-size:11px;color:var(--txt3)">Float over other apps <!-- TODO(java): setBubbleMetadata() --></div>
    </div>
  </label>
  <div style="height:12px"></div>`;
}

function backToSel(){CR.step=0;renderCreate();updateFab()}
function setCond(c){
  CR.cond=c;
  const sub=document.getElementById('used-sub');
  if(sub)sub.style.display=c==='used'?'block':'none';
}
function pickIcon(type,val){
  if(type==='app')CR.icon={type:'app',pkg:val,src:APPS.find(a=>a.pkg===val)?.icon};
  else if(type==='preset')CR.icon={type:'preset',e:val,src:val};
  else if(type==='lib')CR.icon={type:'lib',idx:val,src:ST.iconLib[val]};
  renderCreate();showFab('üíæ');
}
function uploadIcon(inp){
  const f=inp.files[0];if(!f)return;
  const r=new FileReader();
  r.onload=e=>{
    ST.iconLib.push(e.target.result);
    CR.icon={type:'lib',idx:ST.iconLib.length-1,src:e.target.result};
    save();snack('Icon saved to library');renderCreate();showFab('üíæ');
  };r.readAsDataURL(f);
}
function tgl(id,show){const el=document.getElementById(id);if(el)el.style.display=show?'':'none'}

// ‚îÄ‚îÄ SAVE ‚îÄ‚îÄ
function saveRoutine(){
  const msg=(document.getElementById('notif-m')?.value||CR.msg).trim();
  const ttl=(document.getElementById('notif-t')?.value||CR.title).trim();
  if(!msg){snack('Message is required');return;}
  const r={
    id:Date.now().toString(),
    apps:CR.selected.map(a=>({name:a.name,pkg:a.pkg,icon:a.icon})),
    cond:CR.cond,dur:CR.dur,unit:CR.unit,timeMode:CR.timeMode,
    icon:CR.icon,titleOn:CR.titleOn,title:ttl,msg,
    bubble:CR.bubble,enabled:true,createdAt:Date.now()
  };
  ST.routines.unshift(r);save();snack('Routine saved!');resetCreate();switchTab('list');
  dlog('Saved: '+r.id);
}

function resetCreate(){
  CR={step:0,selected:[],multi:false,cond:'launched',dur:20,unit:'m',timeMode:'session',icon:null,titleOn:false,title:'',msg:'',bubble:false};
  renderCreate();hideFab();
}

// ‚îÄ‚îÄ LIST ‚îÄ‚îÄ
function renderList(){
  const el=document.getElementById('list-content');
  if(!ST.routines.length){
    el.innerHTML=`<div class="empty"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M9 5H7a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-2M9 5a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2M9 5a2 2 0 0 0 2-2h2a2 2 0 0 0 2 2"/></svg><p>No routines yet.<br>Go to <b>Create</b> to add one.</p></div>`;
    return;
  }
  el.innerHTML=ST.routines.map(r=>routineCard(r)).join('');
}

function rIcon(r){
  const main=r.apps[0];
  if(!r.icon)return main.icon;
  if(r.icon.type==='lib')return`<img src="${r.icon.src}" style="width:100%;height:100%;object-fit:cover;border-radius:10px">`;
  if(r.icon.type==='preset')return r.icon.e;
  return main.icon;
}

function routineCard(r){
  const lbl=r.cond==='launched'?'On launch':r.cond==='exiting'?'On exit':`After ${r.dur}${r.unit} (${r.timeMode==='total'?'daily total':'session'})`;
  const aLbl=r.apps.length>1?`${r.apps[0].name} +${r.apps.length-1} more`:r.apps[0].name;
  return `<div class="rcard" onclick="openDetail('${r.id}')">
    <div class="rcard-icon">${rIcon(r)}</div>
    <div style="flex:1;min-width:0">
      <div class="rcard-name">${r.titleOn&&r.title?r.title:aLbl}</div>
      <div class="rcard-sub">${aLbl} ¬∑ ${lbl}</div>
      <div class="rcard-meta">
        <span class="chip${r.enabled?' on':''}" style="font-size:10px;padding:2px 8px">${r.enabled?'active':'paused'}</span>
        ${r.bubble?'<span class="chip" style="font-size:10px;padding:2px 8px">bubble</span>':''}
      </div>
    </div>
    <label class="toggle" onclick="event.stopPropagation()">
      <input type="checkbox" ${r.enabled?'checked':''} onchange="toggleR('${r.id}',this.checked)">
      <div class="toggle-track"></div>
    </label>
  </div>`;
}

function toggleR(id,val){
  const r=ST.routines.find(x=>x.id===id);
  if(r){r.enabled=val;save();renderList();snack(val?'Enabled':'Paused');}
  // TODO(java): bind/unbind AccessibilityService or UsageStats observer on toggle
}

function openDetail(id){
  const r=ST.routines.find(x=>x.id===id);if(!r)return;
  const lbl=r.cond==='launched'?'When app is launched':r.cond==='exiting'?'When exiting':
    `After ${r.dur}${r.unit} of ${r.timeMode==='total'?'cumulative daily':'uninterrupted session'} use`;
  const html=`
    <div style="padding:20px 20px 16px;border-bottom:var(--line);display:flex;align-items:center;gap:14px">
      <div style="width:52px;height:52px;border-radius:var(--rad2);background:var(--bg3);border:var(--line);display:flex;align-items:center;justify-content:center;font-size:26px;flex-shrink:0;overflow:hidden">${rIcon(r)}</div>
      <div style="flex:1;min-width:0">
        ${r.titleOn&&r.title?`<div style="font-size:15px;font-weight:600;margin-bottom:2px">${r.title}</div>`:''}
        <div style="font-size:12px;color:var(--txt2);white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${r.apps.map(a=>a.name).join(', ')}</div>
      </div>
    </div>
    <div class="row" style="cursor:default">
      <div style="font-size:10px;letter-spacing:.08em;text-transform:uppercase;color:var(--txt3);width:72px;flex-shrink:0">Condition</div>
      <div style="font-size:13px;color:var(--txt)">${lbl}</div>
    </div>
    <div class="row" style="cursor:default;align-items:flex-start">
      <div style="font-size:10px;letter-spacing:.08em;text-transform:uppercase;color:var(--txt3);width:72px;flex-shrink:0;padding-top:2px">Message</div>
      <div style="font-size:13px;color:var(--txt);line-height:1.6">${r.msg}</div>
    </div>
    <div class="row" style="cursor:default">
      <div style="font-size:10px;letter-spacing:.08em;text-transform:uppercase;color:var(--txt3);width:72px;flex-shrink:0">Status</div>
      <span class="chip${r.enabled?' on':''}" style="font-size:11px">${r.enabled?'active':'paused'}</span>
      ${r.bubble?'<span class="chip" style="font-size:11px;margin-left:6px">bubble</span>':''}
    </div>
    <div style="padding:16px 20px">
      <button class="btn btn-danger" onclick="deleteR('${r.id}')">Delete routine</button>
    </div>`;
  openSheet(r.titleOn&&r.title?r.title:'Detail',html);
}

function deleteR(id){
  if(!confirm('Delete this routine?'))return;
  ST.routines=ST.routines.filter(r=>r.id!==id);
  save();closeSheet();renderList();snack('Deleted');
}

// ‚îÄ‚îÄ SETTINGS ‚îÄ‚îÄ
function renderSettings(){
  const el=document.getElementById('settings-content');
  const cur=ST.settings.theme||'default';
  const cur_d=ST.settings.design||'2';
  el.innerHTML=`
  <div style="padding:10px 20px 4px;font-size:10px;font-weight:500;letter-spacing:.1em;text-transform:uppercase;color:var(--txt3)">Global Design</div>
  <div style="padding:12px 20px 14px;border-bottom:var(--line)">
    <div style="font-size:11px;color:var(--txt3);margin-bottom:10px">Changes apply instantly ‚Äî no restart needed</div>
    <div style="display:flex;gap:8px">
      ${DESIGNS.map(d=>`
        <div onclick="switchDesign('${d.id}')" style="flex:1;padding:12px;border-radius:var(--rad2);border:1px solid ${cur_d===d.id?'var(--acc)':'var(--bg4)'};background:${cur_d===d.id?'var(--acc-dim)':'var(--bg3)'};cursor:pointer;transition:all var(--trans)">
          <div style="font-size:13px;font-weight:${cur_d===d.id?'600':'400'};color:${cur_d===d.id?'var(--acc)':'var(--txt)'};margin-bottom:3px">${d.label}</div>
          <div style="font-size:11px;color:var(--txt3);line-height:1.4">${d.desc}</div>
          ${cur_d===d.id?`<div style="font-size:10px;color:var(--acc);margin-top:6px;letter-spacing:.04em">‚óè Active</div>`:`<div style="font-size:10px;color:var(--txt3);margin-top:6px">Tap to switch</div>`}
        </div>`).join('')}
    </div>
  </div>

  <div style="padding:10px 20px 4px;font-size:10px;font-weight:500;letter-spacing:.1em;text-transform:uppercase;color:var(--txt3)">Appearance</div>
  <div style="padding:14px 20px;border-bottom:var(--line);display:flex;flex-wrap:wrap;gap:14px">
    ${THEMES.map(t=>`
      <div style="display:flex;flex-direction:column;align-items:center;gap:5px;cursor:pointer" onclick="setTheme('${t.id}')">
        <div class="theme-swatch${cur===t.id?' active':''}" style="background:linear-gradient(135deg,${t.b},${t.a})">
          <div style="position:absolute;inset:5px;border-radius:50%;background:${t.bg};opacity:.75"></div>
        </div>
        <span style="font-size:9px;color:${cur===t.id?'var(--acc)':'var(--txt3)'};font-weight:500;letter-spacing:.04em">${t.label}</span>
      </div>`).join('')}
  </div>

  <div style="padding:10px 20px 4px;font-size:10px;font-weight:500;letter-spacing:.1em;text-transform:uppercase;color:var(--txt3)">Notifications</div>
  <div class="row" style="cursor:default">
    <div style="flex:1">
      <div style="font-size:13px;font-weight:500">Default Bubble</div>
      <div style="font-size:11px;color:var(--txt3);margin-top:2px">Bubble on for new routines</div>
    </div>
    <label class="toggle"><input type="checkbox" ${ST.settings.defaultBubble?'checked':''} onchange="ST.settings.defaultBubble=this.checked;save()"><div class="toggle-track"></div></label>
  </div>

  <div style="height:1px;background:var(--bg4);margin:4px 0"></div>
  <div style="padding:10px 20px 4px;font-size:10px;font-weight:500;letter-spacing:.1em;text-transform:uppercase;color:var(--txt3)">Permissions</div>
  <div class="row" onclick="reqUsage()">
    <div style="flex:1"><div style="font-size:13px;font-weight:500">Usage Access</div><div style="font-size:11px;color:var(--txt3)">Track app foreground time</div></div>
    <span class="badge badge-req">Required</span>
  </div>
  <div class="row" onclick="reqNotif()">
    <div style="flex:1"><div style="font-size:13px;font-weight:500">Notifications</div><div style="font-size:11px;color:var(--txt3)">Send notification alerts</div></div>
    <span class="badge badge-req">Required</span>
  </div>
  <div class="row" onclick="reqBoot()">
    <div style="flex:1"><div style="font-size:13px;font-weight:500">Start on Boot</div><div style="font-size:11px;color:var(--txt3)">Auto-start when device boots</div></div>
    <span class="badge badge-opt">Optional</span>
  </div>
  <div class="row" onclick="reqBattery()">
    <div style="flex:1"><div style="font-size:13px;font-weight:500">Unrestrict Battery</div><div style="font-size:11px;color:var(--txt3)">Prevent background kill</div></div>
    <span class="badge badge-opt">Optional</span>
  </div>

  <div style="height:1px;background:var(--bg4);margin:4px 0"></div>
  <div style="padding:10px 20px 4px;font-size:10px;font-weight:500;letter-spacing:.1em;text-transform:uppercase;color:var(--txt3)">App</div>
  <div class="row" onclick="rescanApps()">
    <div style="flex:1"><div id="rescan-lbl" style="font-size:13px;font-weight:500">Rescan installed apps</div><div style="font-size:11px;color:var(--txt3)">Refresh app list</div></div>
    <span style="color:var(--txt3);font-size:16px">‚Üª</span>
  </div>
  <div class="row" onclick="checkUpdate()">
    <div style="flex:1"><div style="font-size:13px;font-weight:500">Check for update</div><div style="font-size:11px;color:var(--txt3)">Latest release</div></div>
    <span style="font-size:11px;color:var(--txt3);font-family:'DM Mono',monospace">v${V}</span>
  </div>

  <div style="height:1px;background:var(--bg4);margin:4px 0"></div>
  <div style="padding:10px 20px 4px;font-size:10px;font-weight:500;letter-spacing:.1em;text-transform:uppercase;color:var(--txt3)">Icon Library</div>
  ${ST.iconLib.length?`
  <div style="padding:12px 20px;border-bottom:var(--line);display:flex;flex-wrap:wrap;gap:8px">
    ${ST.iconLib.map((s,i)=>`<div style="position:relative">
      <img src="${s}" style="width:40px;height:40px;border-radius:var(--rad2);object-fit:cover;border:var(--line)">
      <button onclick="removeIcon(${i})" style="position:absolute;top:-5px;right:-5px;width:16px;height:16px;border-radius:50%;background:var(--danger);border:none;color:#fff;font-size:9px;cursor:pointer;display:flex;align-items:center;justify-content:center">‚úï</button>
    </div>`).join('')}
  </div>
  <div class="row" onclick="clearLib()"><div style="font-size:13px;color:var(--danger)">Clear library</div><span style="font-size:11px;color:var(--txt3)">${ST.iconLib.length} icons</span></div>`
  :`<div class="row" style="cursor:default"><div style="font-size:13px;color:var(--txt3)">No saved icons</div></div>`}

  <div style="height:1px;background:var(--bg4);margin:4px 0"></div>
  <div style="padding:10px 20px 4px;font-size:10px;font-weight:500;letter-spacing:.1em;text-transform:uppercase;color:var(--txt3)">Data</div>
  <div class="row" onclick="exportData()"><div style="font-size:13px;font-weight:500">Export routines</div><span style="color:var(--txt3);font-size:16px">‚Üó</span></div>
  <div class="row" onclick="clearAll()"><div style="font-size:13px;color:var(--danger)">Clear all data</div></div>

  <div style="height:1px;background:var(--bg4);margin:4px 0"></div>
  <div style="padding:10px 20px 4px;font-size:10px;font-weight:500;letter-spacing:.1em;text-transform:uppercase;color:var(--txt3)">System</div>
  <div class="row" onclick="openDebug()"><div style="font-size:13px;font-weight:500">Debug console</div><span style="font-size:11px;color:var(--txt3);font-family:'DM Mono',monospace">v${V}</span></div>

  <div style="height:1px;background:var(--bg4);margin:4px 0"></div>
  <div style="padding:10px 20px 4px;font-size:10px;font-weight:500;letter-spacing:.1em;text-transform:uppercase;color:var(--txt3)">About</div>
  <div class="row" onclick="openAbout()">
    <div style="flex:1"><div style="font-size:13px;font-weight:500">CueAside</div><div style="font-size:11px;color:var(--txt3)">v${V} ¬∑ ${BUILD_DATE}</div></div>
    <span style="color:var(--txt3);font-size:16px">‚Ä∫</span>
  </div>
  <div style="height:20px"></div>`;
}

function openAbout(){
  const html=`
    <div style="padding:28px 20px 20px;border-bottom:var(--line);display:flex;align-items:center;gap:16px">
      <div style="width:56px;height:56px;border-radius:16px;background:var(--bg3);border:var(--line);display:flex;align-items:center;justify-content:center;font-size:28px;flex-shrink:0">‚óé</div>
      <div>
        <div style="font-size:18px;font-weight:600;letter-spacing:-.02em">CueAside</div>
        <div style="font-size:12px;color:var(--txt3);margin-top:3px;font-family:'DM Mono',monospace">v${V}</div>
      </div>
    </div>
    <div class="row" style="cursor:default">
      <div style="font-size:10px;letter-spacing:.08em;text-transform:uppercase;color:var(--txt3);width:64px;flex-shrink:0">Created</div>
      <div style="font-size:13px">${BUILD_DATE}</div>
    </div>
    <div class="row" style="cursor:default;align-items:flex-start">
      <div style="font-size:10px;letter-spacing:.08em;text-transform:uppercase;color:var(--txt3);width:64px;flex-shrink:0;padding-top:2px">About</div>
      <div style="font-size:13px;line-height:1.65;color:var(--txt2)">App-triggered notification routines. Set conditions on app usage and fire custom alerts via Usage Access &amp; Android Notifications.</div>
    </div>
    <div style="padding:14px 20px;display:flex;gap:8px;border-top:var(--line)">
      <div style="flex:1;padding:12px;background:var(--bg3);border-radius:var(--rad2);border:var(--line);text-align:center">
        <div style="font-size:17px;font-weight:600">${ST.routines.length}</div>
        <div style="font-size:10px;color:var(--txt3);margin-top:2px">routines</div>
      </div>
      <div style="flex:1;padding:12px;background:var(--bg3);border-radius:var(--rad2);border:var(--line);text-align:center">
        <div style="font-size:17px;font-weight:600">${ST.iconLib.length}</div>
        <div style="font-size:10px;color:var(--txt3);margin-top:2px">icons</div>
      </div>
      <div style="flex:1;padding:12px;background:var(--bg3);border-radius:var(--rad2);border:var(--line);text-align:center">
        <div style="font-size:17px;font-weight:600">${THEMES.length}</div>
        <div style="font-size:10px;color:var(--txt3);margin-top:2px">themes</div>
      </div>
    </div>`;
  openSheet('About',html);
  dlog('About opened');
}

function reqUsage(){snack('Android: Settings ‚Üí Usage Access');dlog('TODO(java): ACTION_USAGE_ACCESS_SETTINGS')}
function reqNotif(){snack('Android: Settings ‚Üí Notifications');dlog('TODO(java): requestPermissions(POST_NOTIFICATIONS)')}
function reqBoot(){snack('Android: Settings ‚Üí Apps ‚Üí CueAside ‚Üí Permissions');dlog('TODO(java): RECEIVE_BOOT_COMPLETED in AndroidManifest + BroadcastReceiver')}
function reqBattery(){snack('Android: Settings ‚Üí Battery ‚Üí CueAside ‚Üí Unrestricted');dlog('TODO(java): ACTION_REQUEST_IGNORE_BATTERY_OPTIMIZATIONS')}

let _scanning=false;
function rescanApps(){
  if(_scanning)return;
  _scanning=true;
  const inner=document.getElementById('rescan-lbl');
  if(inner)inner.textContent='Scanning‚Ä¶';
  dlog('TODO(java): PackageManager.queryIntentActivities ‚Üí rebuild APPS list');
  setTimeout(()=>{
    _scanning=false;
    snack('App list rescanned');
    // TODO(java): replace APPS array with fresh query result here
    dlog('Rescan complete (mock)');
    renderSettings();
  },1800);
}

const UPDATE_URL='https://github.com/your-org/cue-aside/releases/latest'; // TODO: replace with real URL
function checkUpdate(){
  snack('Opening release page‚Ä¶');
  dlog('TODO: open '+UPDATE_URL);
  // TODO(java): startActivity(new Intent(Intent.ACTION_VIEW, Uri.parse(UPDATE_URL)))
  // For web preview only:
  try{window.open(UPDATE_URL,'_blank')}catch(e){dlog('Could not open URL: '+e)}
}
function removeIcon(i){ST.iconLib.splice(i,1);save();renderSettings();snack('Icon removed')}
function clearLib(){if(!confirm('Clear icon library?'))return;ST.iconLib=[];save();renderSettings();snack('Library cleared')}
function exportData(){
  const j=JSON.stringify({v:V,exported:new Date().toISOString(),routines:ST.routines},null,2);
  const a=document.createElement('a');a.href='data:application/json;charset=utf-8,'+encodeURIComponent(j);
  a.download='notify-routines-export.json';a.click();dlog('Exported');
}
function clearAll(){if(!confirm('Delete ALL data?'))return;ST.routines=[];ST.iconLib=[];save();renderList();renderSettings();snack('Cleared')}

// ‚îÄ‚îÄ INIT ‚îÄ‚îÄ
(function(){load();applyTheme(ST.settings.theme||'default');applyDesign(ST.settings.design||'2');renderCreate();dlog('v'+V+' ready')})();
</script>
</body></html>
